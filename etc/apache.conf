<Directory "/var/www/dsingleton.co.uk/www">

    RewriteEngine On
    
    
    ## Domain Canonicalisation
    
    # Canonicalise out www and old sub domain that duplicated content
    RewriteCond %{HTTP_HOST} ^www.dsingleton.co.uk [NC]
    RewriteRule ^(.*)$ http://dsingleton.co.uk/$1 [L,R=301]
    
    RewriteCond %{HTTP_HOST} ^me.dsingleton.co.uk [NC]
    RewriteRule ^(.*)$ http://dsingleton.co.uk/$1 [L,R=301]
    # RewriteRule ^(.*)$ http://%{SERVER_NAME}/$1 [L,R=301]
        
    
    ## Blog 
    
    # Special cases where the slug has changed
    RewriteRule ^archive/sxsw-day-1-in-an-aeroplane-over-the-sea/{0,1}.*$ /blog/sxsw-day-one [R=permanent,L,NC] 
    RewriteRule ^archive/post-dconstruct-a-review/{0,1}.*$ /blog/dconstruct-2006 [R=permanent,L,NC] 
    RewriteRule ^archive/28/{0,1}.*$ /blog/xfn-icons-css [R=permanent,L,NC] 
    
    # Default case, redirect with slug (old Wordpress URLs)
    RewriteRule ^archive?/(.[^/.]*)/{0,1}.*$ /blog/$1 [R=permanent,L,NC] 
    
    ## URL Canonicalisation
    
    # Strip trailing slashes, this is also getting fucked by multi-view. Uncomment once fixed.
    # RewriteRule ^(.+)/$ http://%{HTTP_HOST}/$1 [R=permanent,L]
    
    
    ## App routing
    
    # This is a right fucking pain. I need to disable multi-view and do proper dispatch/URL handling.  
    # Probably shouldn't be a 301 perm redirect
    # RewriteRule ^(.*)\.php/{0,1}(.*)$ http://dsingleton.co.uk/$1/$2 [L,R=301]
    
</Directory>